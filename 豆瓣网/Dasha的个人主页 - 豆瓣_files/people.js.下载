"use strict";function _defineProperty(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function _objectWithoutProperties(e,t){var a={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(a[r]=e[r]);return a}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}var _slicedToArray=function(){function e(e,t){var a=[],r=!0,n=!1,o=void 0;try{for(var s,i=e[Symbol.iterator]();!(r=(s=i.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{!r&&i.return&&i.return()}finally{if(n)throw o}}return a}return function(t,a){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,a);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e};!function(){function e(e){e.stopPropagation(),e.preventDefault()}function t(e){for(var t in e)"constructor"!==t&&"function"==typeof e[t]&&!function(){var a=e[t];e[t]=function(){try{for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return a.call.apply(a,[this].concat(t))}catch(e){"undefined"!=typeof ErrorReporter&&ErrorReporter.reportError(e)}}}();e.data=e.data||{},e.withCk!==!1&&(e.data.ck=get_cookie("ck")),e.data.for_web||(e.data.for_mobile=1),e.error=e.error||function(e){return dui.toast.warn(e)};var a=e.ajaxError||function(){return dui.toast.networkError()};e.ajaxError=function(e){e=e||new Error("无网络连接"),e.isAjaxError=!0,a(e)},$.ajax($.extend({type:e.type||e.method||"GET",url:e.url,data:e.data,dataType:e.dataType||"json",xhrFields:{withCredentials:!("withCredentials"in e)||e.withCredentials},success:function(t){t.error?e.error?e.error(t.error,t.data,t):alert(t.error):e.success&&e.success(t)},error:function(t){if(0===t.status)e.ajaxError&&e.ajaxError();else{var a=$.parseJSON(t.response);1e3===a.code&&(a.localized_message="没有登录",o()),e.error&&e.error(a.localized_message,a)}},complete:function(t,a){e.complete&&e.complete(t,a)}},e.extra))}function a(e){for(var t={},a=function(t){return e[t]instanceof Function&&!t.match(/^component|^render$|^constructor$/)},r=[].concat(_toConsumableArray(Object.keys(e).filter(a))),n=e;n=Object.getPrototypeOf(n);){var o=Object.getOwnPropertyNames(n);if(o.indexOf("setState")>=0)break;r=r.concat(o.filter(a))}return r.forEach(function(a){t[a]=e[a],e[a]=e[a].bind(e)}),t}function r(e,t){e&&(/^http/.test(e)||e.indexOf("?")!==-1)||(t=e,e=location.href);var a=e.indexOf("?"),r={};if(a<0)return void 0===t?r:"";for(var n=e.substring(a+1),o=n.split("&"),s=void 0,i=void 0,l=void 0,c=0,u=o.length;c<u;c++)if(s=o[c].indexOf("="),s!==-1&&(i=o[c].substring(0,s),l=o[c].substring(s+1),r[i]=decodeURIComponent(l),t===i))return r[i];return void 0===t?r:""}function n(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=/(#.*)$/;t=_extends({},r(e),t);var n=e.match(a),o=n?n[1]:"";e=e.replace(a,"").replace(/\?.*$/,"");var s=Object.keys(t).filter(function(e){return null!=t[e]}).map(function(a){return e=e.replace(new RegExp(a+"=[^&]+&?","g"),""),a+"="+encodeURIComponent(t[a])}).join("&");return e+"?"+s+o}function o(){try{location.hostname.indexOf("dae-pre")>=0&&get_cookie("ck")&&t({url:"https://m.douban.com/pwa/offline",dataType:"html",extra:{timeout:1e4,error:function(e){return console.error(e)}}})}catch(e){window.console&&console.warn&&console.warn(e)}}function s(e){return e?e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):""}function i(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=t.br,r=void 0===a||a,n=t.hashtag,o=void 0===n||n;return e?(e=s(e),r&&(e=e.replace(/\n/g,"<br/>")),o&&(e=e.replace(/#([^#]+?)#/g,'<a href="/hashtag/$1">#$1#</a>')),e=e.replace(/(http[s]?:\/\/dou\.bz\/\w+)/g,'<a href="$1">$1</a>')):e}function l(e){return e?e.replace(/<[^>]*?>/g,""):""}function c(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"douban://douban.com/",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=t.from,r=void 0===a?"mdouban":a,o=t.source,s=void 0===o?"":o,i=t.promo_type,l=void 0===i?"":i,c=t.promo_copy_no,u=void 0===c?"1":c,p=t.is_download_url,m=void 0!==p&&p,h=t.direct_dl,d=void 0===h?"1":h,f=t.returnUrl,v=void 0!==f&&f,g=t.fallback,_=void 0===g?"":g,y=t.android_dispatch,b=void 0!==y&&y,w=void 0;if(m)w="https://www.douban.com/doubanapp/app?from="+r+"&page="+l+"&model=B&copy="+u+"&channel="+s+"&direct_dl="+d;else{var k=navigator.userAgent.toLowerCase(),E=/(iphone|ipad|ipod|ios)/i.test(k),N=k.match(/(android);?[\s\/]+([\d.]+)?/),C=function(){var e=k.match(/os ([0-9]+)_/);return e?+e[1]:0};e.match(/^douban:\/\//)||(e="douban://douban.com"+e),w=n("https://www.douban.com/doubanapp/card/get_app",{client_uri:encodeURIComponent(e),from:r,page:l,model:"B",copy:u,channel:s,fallback:encodeURIComponent(_)});var I=e.replace("douban://douban.com","")||"/";if("/"===I&&(I="/recommend_feed"),N&&b){var S="https://www.douban.com/doubanapp/dispatch?uri="+encodeURIComponent(I)+"&fallback="+encodeURIComponent(_),x="douban://douban.com/webview?url="+encodeURIComponent(S);w="https://www.douban.com/doubanapp/card/get_app?client_uri="+encodeURIComponent(x)}else E&&C()>=9&&(w=n(R,{download:1,from:r,uri:encodeURIComponent(I),page:l,model:"B",copy:u,channel:s,fallback:encodeURIComponent(_)}))}return v?w:void(location.href=w)}function u(){return React.createElement("div",{className:"loading"})}function p(e){var t={className:"cover",style:null},a=!(!e.photos.length||!e.photos_count);return e.large_cover_url?t.style={backgroundImage:"url("+e.large_cover_url+")"}:a?e.photos=e.photos.length>=3?e.photos.slice(0,3):e.photos.slice(0,1):t.className+=" no-bg",React.createElement("div",{className:"item "+e.type,key:e.uri},React.createElement("a",{href:e.uri.match(/^http/)?e.uri:e.url},React.createElement("div",t,a&&React.createElement("div",{className:"photo-mask"},e.photos.map(function(e){return React.createElement("div",{key:e.id,className:"photo",style:{backgroundImage:"url("+e.image.small.url+")"}})})),React.createElement("div",{className:"title"},React.createElement("div",{className:"icon"}),React.createElement("div",{className:"text"},"热门",e.activity)),e.photos_count?React.createElement("div",{className:"photos-count"},e.photos_count,"张"):null),React.createElement("div",{className:"content"},React.createElement("div",{className:"title"},e.title),React.createElement("div",{className:"abstract"},e.abstract)),React.createElement("div",{className:"info"},React.createElement(E,{name:"like",text:e.likers_count}),React.createElement(E,{name:"comment",text:e.comments_count}))))}function m(e,t){t={containerId:t&&t.containerId||null,containerClass:t&&t.containerClass||null};var a=0,r=function(r){function n(e){_classCallCheck(this,n);var t=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return t._renderSubtree=t._renderSubtree.bind(t),t._copyMethods=t._copyMethods.bind(t),t}return _inherits(n,r),_createClass(n,[{key:"componentWillMount",value:function(){a++,this.container=document.createElement("div"),t.containerId&&(this.container.id=t.containerId+"_"+a),t.containerClass&&(this.container.className=t.containerClass),document.body.appendChild(this.container),this._renderSubtree(this.props,this._copyMethods,!1)}},{key:"_renderSubtree",value:function(t,a){function r(){o.container&&ReactDOM.unstable_renderSubtreeIntoContainer(o,React.createElement(e,t,t.children),o.container,function(){this&&this!==window&&(o.instance=this),a&&a.call(this)})}var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=this;n?setTimeout(r):r()}},{key:"_copyMethods",value:function(){var t=this,a=this.instance;a&&[].concat(_toConsumableArray(Object.getOwnPropertyNames(e.prototype)),_toConsumableArray(Object.keys(a))).forEach(function(e){if(a[e]instanceof Function&&!(e in t)&&!e.match(/^component/)&&!e.match(/^_/)){var r=a[e];t[e]=function(){var e=arguments;this._renderSubtree(this.props,function(){r.apply(a,[].slice.call(e))})}}})}},{key:"componentWillReceiveProps",value:function(e){this._renderSubtree(e)}},{key:"render",value:function(){return null}},{key:"componentWillUnmount",value:function(){this._clearContainer()}},{key:"_clearContainer",value:function(){ReactDOM.unmountComponentAtNode(this.container),document.body.removeChild(this.container),this.instance=null,this.container=null}}]),n}(React.Component),n=e.displayName||e.name||"Component";return r.displayName="RootDomWrapper("+n+")",r}function h(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=t.fallbackUrl,r=void 0===a?R+e.replace("douban://douban.com",""):a,n=t.extra,o=void 0===n?{}:n,s=e.match(/\/(\w+)\/(\d+)(?:\/|$)/);if(r=r||""+R+e.replace(k,""),!s)return r;var i=_slicedToArray(s,3),l=(i[0],i[1]),c=i[2];if(l in h.SUBJECT_TYPES){var u=l;return"tv"===l&&(u="movie"),"app"===l&&(u="mobileapp"),"/"+u+"/subject/"+c+"/"}switch(l){case"note":return"/note/"+c+"/";case"event":return"https://www.douban.com/event/"+c+"/";case"review":if(o.reviewType)return o.reviewType+"/review/"+c}return r}function d(e,t){if(e===t)return!0;if(("undefined"==typeof e?"undefined":_typeof(e))!==("undefined"==typeof t?"undefined":_typeof(t)))return!1;if(!e||!t)return e===t;if("object"!==("undefined"==typeof e?"undefined":_typeof(e)))return e===t;var a=Object.keys(e),r=Object.keys(t);if(a.length!==r.length)return!1;for(var n=0;n<a.length;n++){var o=a[n];if(e[o]!==t[o])return!1}return!0}function f(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=t.lazyImage,r=!(!e.image||!e.image.normal),n=!!e.subtitle,o=["feed-card","article-card",r?"has-cover":"",n?"has-subtitle":""].join(" "),s=e.subtitle,i=e.title,l="text";s||(s=i,i=null,l="title");var c=void 0;if(r){var u={className:"cover"};a?(u["data-src"]=e.image.normal.url,u["data-type"]="cover"):u.style={backgroundImage:"url("+e.image.normal.url+")"},c=React.createElement("div",u)}return React.createElement("div",{className:o},React.createElement("a",{href:f.getUrl(e)},React.createElement("div",{className:"title"},i),React.createElement("div",{className:["detail",r?"has-cover":""].join(" ")},React.createElement("div",{className:l},s),c)))}function v(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=t.lazyImage,r=e.uri.match(/\/(\w+)\/\d+$/),n=void 0;if(r)switch(r[1]){case"app":case"game":case"music":n="75px"}var o={className:"cover",style:{height:n}};return e.image&&e.image.normal&&(a?(o["data-src"]=e.image.normal.url,o["data-type"]="cover"):o.style.backgroundImage="url("+e.image.normal.url+")"),React.createElement("div",{className:"feed-card subject-card",style:{minHeight:n}},React.createElement("a",{href:v.getUrl(e)},React.createElement("div",o),React.createElement("div",{className:"detail"},React.createElement("div",{className:"title"},e.title),v.renderRating(e),React.createElement("div",{className:"text"},e.subtitle))))}function g(e){return React.createElement("div",{className:"subject-wall"},e.subjects.map(function(e){return React.createElement("a",{key:e.url||e.sharing_url,href:h(e.uri,{fallbackUrl:e.url||e.sharing_url}),className:"item"},React.createElement("div",{style:{backgroundImage:e.pic&&"url("+e.pic.normal+")"}}))}))}var _={normal:0,official:1,verified:4},y={NONE:0,LIMITED_TIMELINE:1,LIMITED_PROFILE:2,HIDDEN_PROFILE:3},b=window.React&&React.PropTypes||window.PropTypes,w="https://m.douban.com/rexxar/api",R="https://www.douban.com/doubanapp/dispatch?from=mdouban&download=0&uri=",k="douban://douban.com";t.all=function(e,a){var r=0,n={},o=function(t,o){return["success","error","ajaxError","complete"].reduce(function(s,i){return n[i]=[],s[i]=function(){for(var s,l=arguments.length,c=Array(l),u=0;u<l;u++)c[u]=arguments[u];n[i][o]=c,t[i]&&(s=t[i]).call.apply(s,[null].concat(c)),"complete"===i&&(r++,r===e.length&&Object.keys(a).forEach(function(e){var t;return(t=a[e]).call.apply(t,[null].concat(_toConsumableArray(n[e])))}))},s},{})};e.forEach(function(e,a){return t(_extends({},e,o(e,a)))})},document.referrer&&document.referrer.indexOf("https://accounts.douban.com/")>=0&&o();try{document.domain.indexOf("pre")>=0&&(window.__ajax=t)}catch(e){}var E=function(e){var t=["ic-btn","ic-btn-"+e.name,e.active?"active":"",e.left?"left":"",e.right?"right":""].join(" ");return React.createElement("div",{className:t,onClick:e.onClick},null!==e.text?React.createElement("span",{className:"text"},e.text):null,e.children)};E.propTypes={name:b.string.isRequired,active:b.bool,left:b.bool,right:b.bool,onClick:b.func,children:b.node,text:b.oneOfType([b.string,b.number])},E.defaultProps={text:null};var N=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e=this.props.user,a=void 0;return e.profile_banner&&(a="url("+e.profile_banner.normal+")"),React.createElement("div",{className:"profile-banner",style:{backgroundImage:a},"data-bg":t.getDefaultBg(e)},React.createElement("div",{className:"mask"}),React.createElement("img",{src:e.avatar,alt:e.name,className:"avatar"}))}}],[{key:"getDefaultBg",value:function(e){var t=("0"+e.id+e.name).split("").reduce(function(e,t){return e+t.charCodeAt(0)},0)%3;return["blu","grn","org"][t]}}]),t}(React.PureComponent),C=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e=this.props,t=e.user,a=e.onOpenIntro,r=e.onFollow,n=e.onUnfollow,o=dui.LoginUtil.getUserInfo(),s=o&&+o.id===+t.id;return React.createElement("div",{className:"user-info"},React.createElement("div",{className:"desc"},React.createElement("div",{className:"info"},React.createElement("div",{className:"name"},t.name,t.gender&&React.createElement("span",{className:"gender "+t.gender.toLowerCase()})),React.createElement("div",{className:"loc"},t.loc?t.loc.name:"")),!s&&(t.followed?React.createElement("div",{className:"follow-btn unfollow",onClick:n},"已关注"):React.createElement("div",{className:"follow-btn follow",onClick:r},"关注"))),t.intro&&React.createElement("a",{className:"intro",onClick:a},t.intro))}}]),t}(React.PureComponent),I=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e=this.props.user,t=[{uri:"/collection",text:"书影音",count:e.collected_subjects_count},{uri:"/notes",text:"日记",count:e.notes_count},{uri:"/photos",text:"相册",count:e.photo_albums_count},{uri:"/group",text:"小组",count:e.joined_group_count},{uri:"/statuses",text:"广播",count:e.statuses_count},{uri:"/doulists",text:"豆列",count:e.owned_doulist_count}];return React.createElement("div",{className:"profile-nav"},t.filter(function(e){return e.count}).map(function(t){return React.createElement("a",{key:t.uri,className:"item",href:"/people/"+e.id+t.uri},React.createElement("div",{className:"count"},t.count||0),React.createElement("div",{className:"text"},t.text))}))}}]),t}(React.PureComponent),S=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e=this.props.photos;return e?0===e.length?null:React.createElement("div",{className:"profile-photos"},e.map(function(e){return React.createElement("a",{key:e.id,href:"/photos/photo/"+e.id,className:"item",style:{backgroundImage:"url("+e.image.small.url+")"}})}),React.createElement("a",{href:c("",{returnUrl:!0,is_download_url:!0,source:"other"}),className:"open-app item"},"下载豆瓣App",React.createElement("br",null),"查看全部照片")):u()}}]),t}(React.PureComponent),x=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e=this.props,t=e.user,a=e.followings;return a?0===a.length?null:React.createElement("div",{className:"profile-follow"},React.createElement("a",{className:"following",href:"/people/"+t.id+"/followed"},React.createElement("div",{className:"info"},React.createElement("div",{className:"count"},t.following_count),React.createElement("div",{className:"text"},"TA关注的人")),React.createElement("div",{className:"avatars"},a.slice(0,5).map(function(e){return React.createElement("div",{className:"avatar",key:e.id},React.createElement("img",{src:e.avatar,alt:e.name}))}))),React.createElement("a",{className:"follower",href:"/people/"+t.id+"/follower"},React.createElement("div",{className:"count"},t.followers_count),React.createElement("div",{className:"text"},"关注TA的人"))):u()}}]),t}(React.PureComponent),O=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e=this.props.hotItems;return e?0===e.length?null:React.createElement("div",{className:"hot-cards"},e.map(function(e){return p(e)})):u()}}]),t}(React.PureComponent),P={format:function(e,t){var a={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length)));for(var r in a)new RegExp("("+r+")").test(t)&&(t=t.replace(RegExp.$1,1===RegExp.$1.length?a[r]:("00"+a[r]).substr((""+a[r]).length)));return t},parse:function(e,t){var a={"y+":0,"M+":1,"d+":2,"h+":3,"m+":4,"s+":5},r=Array.apply(null,Array(6)).map(function(){return 0}),n=0;for(var o in a){var s=new RegExp("("+o+")"),i=t.match(s);if(i){var l=i.index+n,c=l+i[1].length,u=e.substring(l,c),p=parseInt(u,10);if(1===i[1].length){var m=void 0;switch(o){case"M+":m=12;break;case"d+":m=31;break;case"h+":case"m+":case"s+":m=60}if(m){u=e.substring(l,c+1);var h=parseInt(u,10);h<=m&&h>=10&&(n++,p=h)}}isNaN(p)&&(p=0,console.error(new Error("DateUtil.parse error: parse('"+e+", "+t+"') "+u+" is not integer!"))),"y+"===o&&p<100?p+=100*parseInt((new Date).getFullYear()/100,10):"M+"===o&&(p-=1),r[a[o]]=p}}return new(Function.prototype.bind.apply(Date,[null].concat(_toConsumableArray(r))))},_agoType:function(){var e=6e4,t=60*e,a=24*t,r=7*a,n=30*a,o=365*a;return{seconds:{label:"秒前",ms:1},minute:{label:"分钟前",ms:e},hour:{label:"小时前",ms:t},day:{label:"天前",ms:a},week:{label:"周前",ms:r},month:{label:"个月前",ms:n},year:{label:"年前",ms:o}}}(),getAgo:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=t.maxDays,r=void 0===a?30:a,n=t.fallbackFormat,o=void 0===n?"yyyy-MM-dd hh:mm:ss":n,s=t.types,i=void 0===s?["year","month","week","day","hour","minute"]:s;"string"==typeof e&&(e=Date.parse(e.replace(/-/g,"/"))),e instanceof Date&&(e=e.getTime());var l=(new Date).getTime(),c=l-e;if(!(c<0)){var u=(c/P._agoType.day.ms|0)<=r,p=void 0;return u&&i.some(function(e){var t=P._agoType[e],a=c/t.ms|0;return a>0&&(p=a+t.label,!0)}),!p&&o&&(p=P.format(new Date(e),o)),p}}},T=function(e){var t=void 0,a=void 0;e.leftBtnText&&(t=React.createElement("div",{className:"btn btn-left "+e.leftBtnCls,onClick:e.onLeftBtnClick},e.leftBtnText)),e.rightBtnText&&(a=React.createElement("div",{className:"btn btn-right "+e.rightBtnCls,onClick:e.onRightBtnClick},e.rightBtnText));var r=["pop-page-header","header",e.show?"show":""].join(" ");return React.createElement("div",{className:r},React.createElement("span",{className:"title"},e.children),t,a)};T.propTypes={children:b.node,leftBtnText:b.string,onLeftBtnClick:b.func,rightBtnText:b.string,onRightBtnClick:b.func},T.defaultProps={leftBtnText:"关闭",leftBtnCls:"",rightBtnCls:""},T=m(T);var j=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"_showPopPage",value:function(){if(this.props.hash){var e=location.hash===this.props.hash;e!==this.props.show&&(e?this.props.onRequestShow&&this.props.onRequestShow():this.props.onRequestHide&&this.props.onRequestHide())}}},{key:"componentDidMount",value:function(){this.props.hash&&($(window).on("hashchange",this._showPopPage.bind(this)),this._showPopPage(),this._showCount++)}},{key:"changeHash",value:function(e,t){var a=t.replaceUrl;if(location.hash!==e){var r=location.href.replace(/#.*$/,"");a?location.replace(r+e):location.href=r+e}}},{key:"componentWillReceiveProps",value:function(e){var t=this.constructor,a=e.withTalionNav;if(e.show!==this.props.show){var r=a?$(".page"):$(".page, #TalionNav");e.show?(t._showCount++,e.hash&&this.changeHash(e.hash,e),r.css("display","none")):(t._showCount--,location.hash===e.hash&&e.hash&&this.changeHash("#",e),0===t._showCount&&r.css("display",""))}}},{key:"componentDidUpdate",value:function(e,t){e.show!==this.props.show&&this.props.show&&this.props.afterShow&&this.props.afterShow()}},{key:"render",value:function(){var e=["pop-page",this.props.show&&"show",this.props.moreClass,this.props.withTalionNav&&"with-talion-nav"].filter(function(e){return e}).join(" "),t=void 0;return this.props.enableTitle&&(t=React.createElement(T,this.props,this.props.title)),React.createElement("div",{className:e},t,React.createElement("div",{className:"content"},this.props.isLoading?React.createElement("div",{className:"loading loading-full"}):this.props.children))}}]),t}(React.Component);j._showCount=0,j.propTypes={title:b.node,enableTitle:b.bool,children:b.node,leftBtnText:b.string,onLeftBtnClick:b.func,rightBtnText:b.string,onRightBtnClick:b.func,isLoading:b.bool,show:b.bool,moreClass:b.string,hash:b.string,onRequestShow:b.func,onRequestHide:b.func,afterShow:b.func,replaceUrl:b.bool,withTalionNav:b.bool},j.defaultProps={enableTitle:!0,isLoading:!1,show:!1,hash:"",moreClass:"",replaceUrl:!0,withTalionNav:!1},j=m(j,{containerId:"pop-page"});var L=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e=this.props,t=e.user,a=e.show,r=e.onRequestHide,n=void 0;return t.profile_banner&&(n="url("+t.profile_banner.large+")"),React.createElement(j,_extends({moreClass:"profile-intro "+(n?"":"no-cover"),show:a,onLeftBtnClick:r,title:"个人简介",hash:"#profile-intro"},this.props),React.createElement("div",{className:"container",style:{backgroundImage:n},"data-bg":N.getDefaultBg(t)},React.createElement("div",{className:"mask"}),React.createElement("div",{className:"intro-header"},React.createElement("h1",null,t.name),React.createElement("div",{className:"info"},React.createElement("div",null,"ID: ",t.uid),React.createElement("div",null,t.reg_time&&t.reg_time.replace(/\s.*$/,""),"加入"))),React.createElement(Linkify,{className:"intro",options:{ignoreTags:["style"],nl2br:!0}},t.intro)))}}]),t}(React.PureComponent);h.SUBJECT_TYPES={movie:1,tv:1,book:1,music:1,game:1,app:1};var M=function(e){function r(e){_classCallCheck(this,r);var t=_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e));return t.firstLoad=!0,t.state={list:[],start:e.start,count:e.count,total:-1,isLoading:!1,isEmpty:!1},a(t),t}return _inherits(r,e),_createClass(r,[{key:"componentDidMount",value:function(){this.props.lazyLoad||this.fetchList()}},{key:"componentWillReceiveProps",value:function(e){var t=this;e.count!==this.state.count&&this.setState({count:e.count}),e.loadIfNever&&this.firstLoad?this.fetchList(e):d(this.props.data,e.data)||this.setState({list:[],start:0},function(){return t.fetchList(e)})}},{key:"parseData",value:function e(t){var e=this.props.parseData;return e?e(t,this.state,this.props):{}}},{key:"handleFetchSuccess",value:function(e){var t=this.props,a=t.onFetch,r=t.listField,n=this.state,o=n.start,s=n.count,i=n.total,l=n.list,c=n.isEmpty;a&&a(e,this.state,this.props),(0===e.total||i===-1&&0===e[r].length)&&(c=!0),this.setState(_extends({list:l.concat(e[r]),start:o+s,count:s,total:e.total,isLoading:!1,isEmpty:c},this.parseData(e)))}},{key:"fetchList",value:function e(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.props;this.firstLoad=!1;var e=(a.onFetch,a.listField,a.parseData,a.fetchList),r=a.parseQuery,n=a.data,o=a.url,s=this.state,i=s.start,l=s.count;s.total,s.list,s.isEmpty;if(this.setState({isLoading:!0}),e)e({state:this.state,handleFetchSuccess:this.handleFetchSuccess,props:a});else{var c=_extends({start:i,count:l},n);r&&(c=r(c)),t({url:o,data:c,success:this.handleFetchSuccess})}}},{key:"reset",value:function(){var e=this;this.setState({list:[],start:0},function(){return e.fetchList()})}},{key:"filter",value:function(e){this.setState({list:this.state.list.filter(e)})}},{key:"rightConcat",value:function(e){e instanceof Array||(e=[e]),this.setState({list:e.concat(this.state.list),total:this.state.total+1})}},{key:"concat",value:function(e){this.setState({list:this.state.list.concat(e),total:this.state.total+1})}},{key:"update",value:function(e){this.setState({list:e(this.state.list)})}},{key:"hasMore",value:function e(){var e=this.props.hasMore;if(e)return e(this.state,this.props);var t=this.state,a=t.start,r=t.total,n=t.list;return"number"!=typeof r?n.length>0:a<r&&r>0}},{key:"renderEmpty",value:function e(){var t=this.props,a=t.emptyNode,e=t.renderEmpty;if(e)return e(this.state,this.props);var r=this.state.isEmpty;return r?a||null:null}},{key:"renderItem",value:function e(t){var e=this.props.renderItem;return e?e(t,this.state,this.props):JSON.stringify(t,null,2)}},{key:"renderLoadMore",value:function(){var e=this,t=this.props,a=t.loadingText,r=t.loadMoreText,n=this.state.isLoading;return this.hasMore()&&(n?React.createElement("a",{className:"load-more disabled"},a):React.createElement("a",{onClick:function(){return e.fetchList()},className:"load-more"},r))}},{key:"renderLoading",value:function(){var e=this.props.loadingNode,t=this.state,a=t.start,r=t.isLoading;return 0===a&&r?e?e:React.createElement("div",{className:"loading"}):null}},{key:"render",value:function(){var e=this,t=this.props,a=t.className,r=t.headerNode,n=t.footerNode,o=this.state.list,s=this.renderEmpty();return React.createElement("ul",{className:a+" base-list"},this.renderLoading(),s,r,o.map(function(t){return e.renderItem(t)}),this.renderLoadMore(),n)}}]),r}(React.Component);M.propTypes={url:b.string,data:b.object,fetchList:b.func,renderItem:b.func.isRequired,className:b.string,listField:b.string,start:b.number,count:b.number,parseQuery:b.func,parseData:b.func,onFetch:b.func,hasMore:b.func,loadingText:b.string,loadMoreText:b.string,renderEmpty:b.func,emptyNode:b.node,headerNode:b.node,footerNode:b.node,loadingNode:b.node,lazyLoad:b.bool,loadIfNever:b.bool},M.defaultProps={start:0,count:10,listField:"list",loadingText:"加载中",loadMoreText:"显示更多",headerNode:null,footerNode:null,lazyLoad:!1,loadIfNever:!1};var F={movie:"电影",tv:"电视剧",book:"图书",music:"唱片",app:"应用",game:"游戏"},U=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));r.state={total:0},r.url=r.getUrl(e);var n=e.type,o=e.listField;return o&&(r.listField=o),"event"===n?r.listField="subjects":r.listField="interests",a(r),r}return _inherits(t,e),_createClass(t,[{key:"getSubtitle",value:function(e){var t=this.props,a=t.status,r=t.subTitleFilter,n=this.getSubject(e),o=this.props.type||n.type;if("event"!==o)switch(a){case"done":case"doing":return e.comment}var s=n.pubdate&&n.pubdate.length&&n.pubdate[0],i=[],l=" / ";switch(o){case"movie":i=[n.genres.join(" / "),s&&s+" 上映",n.directors.map(function(e){return e.name+"(导演)"}).join(" / "),n.actors.map(function(e){return e.name}).join(" / ")];break;case"app":i=[n.app_cate_name,n.platform,n.price];break;case"game":i=[n.genres.join(" / "),n.platforms.map(function(e){return e.cn_name}).join(" / "),n.release_date];break;case"book":var c=n.author&&n.author.join(", "),u=n.press&&n.press.join(", ");i=[c&&"作者："+c,u&&"出版社："+u,s&&"出版时间："+s],l="\n";break;case"music":var p=n.singer&&n.singer.map(function(e){return e.name}).join(", ");i=[p&&"艺术家："+p,s&&"发行时间："+s],l="\n";break;case"event":i=[n.wisher_count+"人感兴趣/"+n.participant_count+"人参加"]}return r&&(i=r(i,n)),i.filter(function(e){return!!e}).join(l)}},{key:"getSubject",value:function e(t){var a=this.props,e=a.getSubject,r=a.type;return e?e(t,this.state,this.props):"event"===r?t:t.subject}},{key:"getUrl",value:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.props,e=t.getUrl,a=t.type,r=t.user,n=t.status;if(e)return e(this.state,t);var o=w+"/v2/user/"+r.id;return"event"===a?"mark"===n?o+"/wish_items?type=event":o+"/attend_items":o+"/interests?type="+a+"&status="+n}},{key:"renderRating",value:function(e,t,a){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"medium",n=arguments[4],o=arguments[5],s=e/t*10;if(a||isNaN(s))return React.createElement("span",{className:"no-rating"},a||"暂无评分");for(var i=[],l=Math.round(s/2),c=Math.round(s)%2,u="rating-star-"+r+"-full",p="rating-star-"+r+"-half",m="rating-star-"+r+"-gray",h=1;h<=5;h++){var d=m;h<=l?d=u:h===l+1&&c&&(d=p),i.push(React.createElement("i",{key:h,className:"rating-star "+d}))}return React.createElement("div",{className:"rating"},React.createElement("span",{className:"rating-stars","data-rating":"100.0"},i),n?React.createElement("span",{className:"score"},n):null,o?React.createElement("span",{className:"create-time"},o):null)}},{key:"getSubjectUrl",value:function(e){return h(e.uri,{fallbackUrl:e.url})}},{key:"renderItem",value:function(e){var t=this.getSubject(e),a=this.props,r=a.type,n=a.status,o=a.renderLabel,s=a.ratingSize,i="cover",l=!0,c=t.rating,u=t.null_rating_reason,p=1,m=3,h=!1,d=c?c.value:0,f=c?c.max:10,v=d,g="";switch(r){case"app":case"music":i+=" square",p=2;break;case"event":l=!1,p=3}if(n)switch(n){case"done":case"doing":var _=e.rating;d=_?_.value:0,f=_?_.max:10,v=0,h=!0,m=0,g=e&&e.create_time?e.create_time.match(/^(\d{2,4}-\d{2}-\d{1,2})/gi):"",u=_?"":"还没有评分"}return React.createElement("li",{key:t.id},React.createElement("a",{href:this.getSubjectUrl(t)},React.createElement("div",{className:i,style:{backgroundImage:t.pic&&"url("+t.pic.large+")"}}),React.createElement("div",{className:"detail"},h&&React.createElement("div",{className:"label"},F[t.type]),React.createElement("div",{className:"title","data-line":p},t.title),l&&this.renderRating(d,f,u,s,v,g),React.createElement("div",{className:"text","data-line":m},this.getSubtitle(e)),o&&o(e))))}},{key:"render",
value:function(){var e=this.props,t=(e.url,_objectWithoutProperties(e,["url"]));return React.createElement(M,_extends({url:this.url,className:"subject-list",listField:this.listField,renderItem:this.renderItem},t))}}]),t}(React.Component);U.propTypes={type:b.string,status:b.string,getUrl:b.func,getSubject:b.func,listField:b.string,subTitleFilter:b.func,renderLabel:b.func,user:b.shape({id:b.string.isRequired}),ratingSize:b.oneOf(["small","medium","big"])};var D=4,A=function(e){function r(e){_classCallCheck(this,r);var t=_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e));return t.state={works:{start:0,count:D+1,total:-1,items:[]},worksPageIsShow:!1},a(t),t.WORKS_API=w+"/v2/user/"+e.user.id+"/works",t}return _inherits(r,e),_createClass(r,[{key:"componentDidMount",value:function(){this.fetchWorks()}},{key:"fetchWorks",value:function(){var e=this,a=(this.props.user,this.state.works),r=a.start,n=a.count;t({url:this.WORKS_API,data:{start:r,count:n},success:function(t){e.setState({works:t})}})}},{key:"toggle",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:!this.state[e];this.setState(_defineProperty({},e,t))}},{key:"renderWorksPage",value:function(){var e=this,t=this.props.user,a=this.state.worksPageIsShow;return React.createElement(j,{title:t.name,leftBtnText:"关闭",onLeftBtnClick:function(){return e.toggle("worksPageIsShow",!1)},onRequestHide:function(){return e.toggle("worksPageIsShow",!0)},onRequestShow:function(){return e.toggle("worksPageIsShow",!0)},show:a,hash:"#works",moreClass:"works-page"},React.createElement("h2",null,"共",t.verify_works_count,"部作品"),React.createElement(U,{getUrl:function(){return e.WORKS_API},user:t,listField:"items",ratingSize:"small",subTitleFilter:function(e,t){return["book","music"].indexOf(t.type)>=0?e.slice(0,2):e},renderLabel:function(e){return React.createElement("div",{className:"desc"},e.desc)}}))}},{key:"renderSingleWorkItem",value:function(e){if(e){var t=e.subject,a=e.desc,r=t.press||t.generes||t.singer,n=[].concat(r).concat(t.pubdate);return t.null_rating_reason||n.unshift(t.rating.value.toFixed(1)+"分"),React.createElement("a",{href:h(t.uri,{fallbackUrl:t.url||t.sharing_url}),className:"work-single",key:t.id},React.createElement("div",{style:{backgroundImage:"url("+(t.pic&&t.pic.normal)+")"},className:"cover"}),React.createElement("div",{className:"details"},React.createElement("h3",null,t.title),React.createElement("div",{className:"info"},n.join(" / ")),React.createElement("div",{className:"desc"},a)))}}},{key:"renderMultiWorkItem",value:function(e){var t=e.subject,a=e.desc;return React.createElement("a",{href:h(t.uri,{fallbackUrl:t.url||t.sharing_url}),className:"item",key:t.id},React.createElement("div",{style:{backgroundImage:"url("+(t.pic&&t.pic.normal)+")"},className:"cover"}),React.createElement("h3",null,t.title),React.createElement("div",{className:"desc"},a))}},{key:"renderWorkItemMore",value:function(e,t){var a=this,r=e.subject,n=(e.desc,this.props.user);return React.createElement("a",{className:"item more",onClick:function(){return a.toggle("worksPageIsShow",!0)}},React.createElement("div",{style:{backgroundImage:"url("+(r.pic&&r.pic.normal)+")"},className:"cover"},React.createElement("div",{className:"mask",style:{backgroundColor:"#"+n.profile_banner.color}}),React.createElement("div",{className:"title"},"更多作品"),React.createElement("hr",null),React.createElement("div",{className:"count"},"+",t)))}},{key:"getHeOrShe",value:function(e){switch(e.gender){case"M":return"他";case"F":return"她";default:return"TA"}}},{key:"renderWorks",value:function(){var e=this,t=this.props.user,a=this.state.works,r=1===t.verify_works_count,n=a.items.length>D,o=React.createElement("div",{className:"work-list"},a.items.slice(0,D).map(function(t){return e.renderMultiWorkItem(t)}),n&&this.renderWorkItemMore(a.items[D],a.total-D));return React.createElement("div",{className:"verify-works "+(r?"single":"multi")},React.createElement("h2",null,this.getHeOrShe(t),"的作品 ",t.verify_works_count),r?this.renderSingleWorkItem(a.items[0]):o,this.renderWorksPage())}},{key:"render",value:function(){var e=this.props,t=e.user,a=e.onFollow,r=e.onUnfollow,n=e.onOpenIntro,o=void 0;t.profile_banner&&(o="url("+t.profile_banner.normal+")");var s=t.profile_banner&&t.profile_banner.color;return React.createElement("div",{className:"profile-banner verified",style:{backgroundImage:o}},React.createElement("div",{className:"mask"}),React.createElement("img",{src:t.avatar,alt:t.name,className:"avatar"}),React.createElement("div",{className:"verify-roles"},t.verify_roles.map(function(e){return React.createElement("div",{className:"item",key:e},e)})),React.createElement("div",{className:"info-section",style:{color:"#"+s}},React.createElement(C,{user:t,onFollow:a,onUnfollow:r,onOpenIntro:n}),this.renderWorks()))}}]),r}(React.PureComponent);A.propTypes={user:b.object,onFollow:b.func,onUnfollow:b.func,onOpenIntro:b.func};var B=function(e){function t(e){_classCallCheck(this,t);var a=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.state={},t.dom||"undefined"==typeof PhotoSwipe||(t.dom=$(t.HTML).appendTo(document.body)[0]),a}return _inherits(t,e),_createClass(t,[{key:"fixIOS8GIF",value:function(){var e=this,t=0;/iP(hone|od|ad)/.test(navigator.platform)&&(t=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),t=parseInt(t[1],10)),t>=8&&this.gallery.listen("afterChange",function(){if(e.gallery.currItem.src.indexOf(".gif")>0){var t=e.gallery.itemHolders[1];if(t&&t.el){var a=t.el.getElementsByClassName("pswp__img");if(a.length){var r=a[a.length-1];r.style.opacity=.99999==r.style.opacity?1:.99999}}}})}},{key:"customInitialZoomLevel",value:function(){var e=this;this.gallery.listen("afterChange",function(){return setTimeout(function(){var t=e.gallery.currItem,a=window.innerWidth,r=a>600;if(t.h>4*t.w){var n=r?1:a/t.w,o={x:(a-t.w*n)/2,y:0};e.gallery.applyZoomPan(n,o.x,o.y),e.gallery.zoomTo(n,o,0),e.gallery.options.handleDoubleTapZoom=function(t){var a=e.gallery,r=1;r=a.getZoomLevel()!==n?n:a.currItem.initialZoomLevel,a.zoomTo(r,t,333)}}else e.gallery.options.handleDoubleTapZoom=null})})}},{key:"componentDidMount",value:function(){t.mountNum=t.mountNum||0,t.mountNum++,this.showPreview()}},{key:"getItems",value:function(){var e=this;return this.props.images.map(function(t){var a=t.url,r=t.width,n=t.height,o=e.props.imageBound;return t.url&&t.url.match(/\?imageView/)&&(a=t.url.replace(/\/format\/webp/,"/format/jpg").replace(/\/w\/(\d+)\/h\/(\d+)\//,function(e,t,a){if(!r||!n)return"/w/"+o+"/h/"+(n||7e3)+"/";var s=Math.min(o/r,1);return r=parseInt(r*s,10),n=parseInt(n*s,10),"/w/"+r+"/h/"+n+"/"})),{src:a,w:r,h:n}})}},{key:"componentWillReceiveProps",value:function(e){e.show!==this.props.show&&this.showPreview(e)}},{key:"showPreview",value:function(){var e=this,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.props;a.show&&(this.gallery=new PhotoSwipe(t.dom,PhotoSwipeUI_Default,this.getItems(),$.extend({galleryUID:"gid_"+t.mountNum},_extends({},a))),this.gallery.listen("close",function(){return e.props.onClose&&e.props.onClose()}),this.gallery.listen("beforeChange",function(){var t=e.gallery.currItem.src;if(!e.gallery.currItem.w){var a=new Image;a.src=t,a.onload=function(){e.gallery.currItem.w=a.width,e.gallery.currItem.h=a.height,e.gallery.updateSize()}}}),this.customInitialZoomLevel(),this.fixIOS8GIF(),this.gallery.init())}},{key:"render",value:function(){return null}}]),t}(React.Component);B.propTypes={show:b.bool,index:b.number,images:b.arrayOf(b.shape({url:b.string.isRequired,width:b.number,height:b.number})),pinchToClose:b.bool,closeOnScroll:b.bool,onClose:b.func,getDoubleTapZoom:b.func,imageBound:b.number},B.defaultProps={showHideOpacity:!0,show:!1,index:0,images:[],pinchToClose:!1,closeOnScroll:!1,closeEl:!0,captionEl:!1,fullscreenEl:!1,zoomEl:!1,shareEl:!1,counterEl:!0,arrowEl:!0,preloaderEl:!1,imageBound:1600,maxSpreadZoom:4,getDoubleTapZoom:function(e,t){return e?2:t.initialZoomLevel<.7?1:2}},B.HTML='\n<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">\n    <div class="pswp__bg"></div>\n    <div class="pswp__scroll-wrap">\n        <div class="pswp__container">\n            <div class="pswp__item"></div>\n            <div class="pswp__item"></div>\n            <div class="pswp__item"></div>\n        </div>\n        <div class="pswp__ui pswp__ui--hidden">\n            <div class="pswp__top-bar">\n                <div class="pswp__counter"></div>\n                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>\n                <button class="pswp__button pswp__button--share" title="Share"></button>\n                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>\n                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>\n                <div class="pswp__preloader">\n                    <div class="pswp__preloader__icn">\n                      <div class="pswp__preloader__cut">\n                        <div class="pswp__preloader__donut"></div>\n                      </div>\n                    </div>\n                </div>\n            </div>\n            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">\n                <div class="pswp__share-tooltip"></div>\n            </div>\n            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">\n            </button>\n            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">\n            </button>\n            <div class="pswp__caption">\n                <div class="pswp__caption__center"></div>\n            </div>\n        </div>\n    </div>\n</div>\n',v.getUrl=f.getUrl=function(e){return e.url?e.url:h(e.uri)},v.renderRating=function(e){var t=e.rating,a=parseFloat(t);if(Number.isNaN(a))return React.createElement("div",{className:"no-rating"},t);for(var r=[],n=Math.round(a/2),o=Math.round(a)%2,s="rating-star-medium-full",i="rating-star-medium-half",l="rating-star-medium-gray",c=1;c<=5;c++){var u=l;c<=n?u=s:c===n+1&&o&&(u=i),r.push(React.createElement("span",{key:c,className:"rating-star "+u}))}return React.createElement("div",{className:"rating"},React.createElement("span",{className:"rating-stars","data-rating":"100.0"},r),React.createElement("span",{className:"score"},t))},v.propTypes=f.propTypes=b.shape({title:b.string,subtitle:b.string,uri:b.string,url:b.string,image:b.object,lazy:b.bool});var W=function(t){function r(e){_classCallCheck(this,r);var t=_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e));return t.state={previewIsShow:!1,index:0},a(t),t}return _inherits(r,t),_createClass(r,[{key:"componentDidMount",value:function(){var e=this;0!==this.props.images.length&&setTimeout(function(){e._root.className.indexOf("multi")>=0&&(e._root.style.fontSize=e._root.clientWidth/10+"px")},10)}},{key:"componentDidUpdate",value:function(e,t){this.componentDidMount()}},{key:"setImageRatio",value:function(e){var t=e.target,a=e.target.className,r=t.naturalWidth>t.naturalHeight?"landscape":"portrait";t.className+=a.replace(/(?:landscape|portrait)/)+r}},{key:"showPreview",value:function(t,a){this.props.enablePreview&&(this.setState({previewIsShow:!0,index:t}),e(a))}},{key:"closePreview",value:function(){this.setState({previewIsShow:!1})}},{key:"renderPreview",value:function(){var e=this.props.images,t=this.state,a=t.previewIsShow,r=t.index;return React.createElement(B,{index:r,images:e.map(function(e){return e.large}),show:a,onClose:this.closePreview})}},{key:"render",value:function(){var e=this,t=this.props,a=t.images,r=t.requestDel,n=t.onlyMulti,o=t.lazy;if(0===a.length)return null;var s=1===a.length&&!n,i=["feed-images",s?"single":"multi"].join(" ");return React.createElement("div",{className:i,ref:function(t){return e._root=t}},a.map(function(t,a){var n=t.normal,i=t.is_animated;n.url=n.url&&n.url.replace(/\/format\/webp/,"/format/jpg");var l=null;n.width&&n.height||(l=e.setImageRatio);var c=["item",n.width>n.height?"landscape":"portrait",i?"gif":"",t.className].join(" "),u={};return o?(u["data-src"]=n.url,u["data-type"]="cover"):s?u.src=n.url:n.url&&(u.style={backgroundImage:"url("+n.url+")"}),React.createElement("div",_extends({className:c},u,{key:t.key||n.url,onClick:e.showPreview.bind(e,a),"data-msg":t.msg}),s&&React.createElement("img",_extends({},u,{onLoad:l})),r&&React.createElement("i",{className:"del",onClick:r.bind(e,t,a)}))}),this.renderPreview())}}]),r}(React.Component);W.defaultProps={onlyMulti:!1};var H=b.shape({url:b.string.isRequired,width:b.number,height:b.number});W.propTypes={images:b.arrayOf(b.shape({is_animated:b.bool,normal:H,large:H,className:b.string})),requestDel:b.func,onlyMulti:b.bool,enablePreview:b.bool};var q=function(e){function r(e){_classCallCheck(this,r);var t=_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e));return t.state={},a(t),t}return _inherits(r,e),_createClass(r,[{key:"fetchList",value:function(e){var a=e.state,r=a.filter_after,n=a.count,o=e.handleFetchSuccess,s=this.props,i=s.slice,l=s.userId;t({url:w+"/v2/user/"+l+"/lifestream",data:{slice:i.slice,hot:i.hot,filter_after:r,count:n},success:o})}},{key:"parseCard",value:function(e){var t=e.content,a=e.uri,r=e.url,n=void 0,o=t.description,s=/^([.\d]*)分\//,i=o&&o.match(s);return i&&(n=i[1],o=o.replace(s,"")),{url:t.card_url||r,uri:t.card_uri||a,title:t.title,subtitle:o||t.abstract,rating:n,image:t.cover_url?{normal:{url:t.cover_url},large:{url:t.cover_url}}:{}}}},{key:"linkTo",value:function(e,t){e&&(e.match(/^http/)?location.href=e:location.href=R+e.replace(k,""))}},{key:"renderItem",value:function(e){var t=e.content,a=void 0,r=t.text,n=!(!e.likers_count&&!e.comments_count||this.isYear);switch(r=i(l(r),{hashtag:!0}),e.type){case"card":switch(e.content.type){case"movie":case"tv":case"music":case"app":case"game":case"book":a=v(this.parseCard(e));break;default:a=f(this.parseCard(e))}break;case"gallery":case"album":t.images=t.photos&&t.photos.slice(0,9).map(function(e){return e.image});break;case"status":break;case"subjects":a=g(t);break;default:a=f(this.parseCard(e))}return React.createElement("li",{className:"life-item",key:e.time+e.activity+e.uri,onClick:this.linkTo.bind(this,e.url),"data-url":e.url},React.createElement("div",{className:"info"},React.createElement("div",{className:"activity"},e.activity),React.createElement("div",{className:"timestamp"},P.getAgo(P.parse(e.time,"yyyy-MM-dd hh:mm:ss"),{maxDays:7,fallbackFormat:"M月d日"}))),React.createElement("div",{className:"content",dangerouslySetInnerHTML:{__html:r}}),t.images&&React.createElement(W,{images:t.images,enablePreview:!0}),a,n&&React.createElement("div",{className:"ic-group"},React.createElement(E,{name:"like",text:e.likers_count}),React.createElement(E,{name:"comment",text:e.comments_count})))}},{key:"parseData",value:function(e,t){return{filter_after:e.next_filter_after}}},{key:"hasMore",value:function(e){var t=e.filter_after,a=e.total;return!!t&&a!==-1}},{key:"render",value:function(){var e=this.props,t=e.slice,a=e.userId,n=e.showAppLink,o=void 0!==n&&n,s=e.count,i=void 0,l=t.slice.split("-"),u=_slicedToArray(l,3),p=u[0],m=u[1],h=u[2];switch(p){case"recent":var d=(new Date).getFullYear();i=React.createElement("hgroup",null,m<d?d:m);break;case"month":i=React.createElement("hgroup",null,React.createElement("h1",null,r.MONTH_MAP[h]),React.createElement("h2",null,m));break;case"year":this.isYear=!0,i=React.createElement("hgroup",null,React.createElement("h1",null,m),React.createElement("h2",null,t.hot?"SELECTS":"ALL"))}return React.createElement("section",{className:"life-section "+p},i,React.createElement(M,{fetchList:this.fetchList,className:"life-list",parseData:this.parseData,hasMore:this.hasMore,listField:"items",count:s,renderItem:this.renderItem,footerNode:o&&React.createElement("a",{href:c(k+"/user/"+a,{source:"other",returnUrl:!0}),className:"load-more"},"打开App查看全部")}))}}]),r}(React.PureComponent);q.MONTH_MAP={1:"一月",2:"二月",3:"三月",4:"四月",5:"五月",6:"六月",7:"七月",8:"八月",9:"九月",10:"十月",11:"十一月",12:"十二月"},q.defaultProps={count:20};var z=function(e){function r(e){_classCallCheck(this,r);var t=_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e));return t.state={slices:[]},a(t),t}return _inherits(r,e),_createClass(r,[{key:"componentDidMount",value:function(){this.fetchSlices()}},{key:"fetchSlices",value:function(){var e=this,a=this.props.userId;t({url:w+"/v2/user/"+a+"/lifestream/timeslices",success:function(t){e.setState({slices:t.timeslices})}})}},{key:"render",value:function(){var e=this.state.slices,t=this.props.userId;return React.createElement("div",{className:"lifestream"},e.map(function(a,r){return React.createElement(q,{key:a.slice,slice:a,userId:t,showAppLink:r===e.length-1})}))}}]),r}(React.PureComponent),Z=function(e){var t=e.reason;return t?React.createElement("div",{className:"out"},React.createElement("div",{className:"profile-truncated"},React.createElement("i",{className:"ic-lock"}),t)):null},K=function(e){function r(e){_classCallCheck(this,r);var t=_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e));return t.state={user:e.user,photos:null,followings:null,hotItems:null,introIsShow:!1},t.BASE_URL=w+"/v2/user/"+e.user.id,a(t),t}return _inherits(r,e),_createClass(r,[{key:"componentDidMount",value:function(){this.fetchUser(),this.fetchPhotos(),this.fetchFollowings(),this.fetchHotItems()}},{key:"fetchUser",value:function(){var e=this;t({url:""+this.BASE_URL,success:function(t){e.setState({user:t})}})}},{key:"_baseFetch",value:function(e){var a=this,r=e.type,n=e.count,o=e.key,s=e.dataKey;t({url:this.BASE_URL+"/"+r,data:{start:0,count:n},success:function(e){a.setState(_defineProperty({},o,e[s]))},error:function(e){a.setState(_defineProperty({},o,[]))}})}},{key:"fetchPhotos",value:function(){this._baseFetch({type:"album_photos",count:10,key:"photos",dataKey:"photos"})}},{key:"fetchFollowings",value:function(){this._baseFetch({type:"following",count:5,key:"followings",dataKey:"users"})}},{key:"fetchHotItems",value:function(){this._baseFetch({type:"hot",count:3,key:"hotItems",dataKey:"items"})}},{key:"_baseFollow",value:function(e){var a=this,r=e.type;dui.LoginUtil.checkLogin()&&t({url:this.BASE_URL+"/"+r,type:"POST",success:function(e){a.setState({user:_extends({},a.state.user,e)})}})}},{key:"follow",value:function(){this._baseFollow({type:"follow"})}},{key:"unfollow",value:function(){this._baseFollow({type:"unfollow"})}},{key:"showIntro",value:function(){this.setState({introIsShow:!0})}},{key:"hideIntro",value:function(){this.setState({introIsShow:!1})}},{key:"render",value:function(){var e=this.state,t=e.user,a=e.photos,r=e.followings,n=e.hotItems,o=e.introIsShow,s=this.props,i=s.is_banned,l=s.is_readonly_forever,c=s.profile_policy,u=s.profile_policy_reason,p=s.login;return i||l?null:React.createElement("div",{className:"people-profile"},React.createElement("section",null,t.verify_type===_.verified?React.createElement(A,{user:t,onFollow:this.follow,onUnfollow:this.unfollow,onOpenIntro:this.showIntro}):React.createElement("div",null,React.createElement(N,{user:t,key:"ProfileBanner"}),React.createElement(C,{user:t,key:"ProfileUserInfo",onFollow:this.follow,onUnfollow:this.unfollow,onOpenIntro:this.showIntro})),function(){return c===y.HIDDEN_PROFILE?React.createElement(Z,{reason:u}):c===y.HIDDEN_PROFILE?p?React.createElement(Z,{reason:u}):null:React.createElement("div",null,React.createElement(I,{user:t}),React.createElement(S,{photos:a}))}()),r?React.createElement("section",null,React.createElement(x,{user:t,followings:r})):null,n&&n.length>0?React.createElement("section",{className:"transparent"},React.createElement(O,{hotItems:n})):null,React.createElement(z,{userId:t.id}),React.createElement(L,{user:t,show:o,onRequestHide:this.hideIntro,onRequestShow:this.showIntro}))}}]),r}(React.Component);ReactDOM.render(React.createElement(K,__INITIAL_STATE__),$("#people-profile").get(0))}();